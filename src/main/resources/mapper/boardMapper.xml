<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="study.dev.thboard3.mapper.BoardMapper">

    <!--게시글 목록 조회-->
    <select id="selectBoardList" resultType="BoardVo">
        /* 게시글 목록 조회 */
         SELECT ROW_NUMBER() OVER(ORDER BY REG_DATE DESC) AS no
              , BOARD_SNO AS boardNo                          /* 게시글 순번 */
              , TITLE AS title                               /* 제목 */
              , CONTENT AS content                           /* 내용 */
              , USER_ID AS userId                            /* 작성자 아이디 */
              , USE_YN AS userYn                             /* 사용여부 */
              , TO_CHAR(REG_DATE, 'YYYY-MM-DD') AS regDate   /* 등록일 */
              , MOD_DATE AS modDate                          /* 수정일 */
              , REPLY_CNT AS replyCnt                        /* 댓글 개수 */
           FROM BOARD_INFO
    </select>

    <!--게시글 전체 카운트-->
    <select id="selectBoardCnt" parameterType="map" resultType="int">
        SELECT COUNT(*)
          FROM BOARD_INFO
        WHERE USE_YN = 'Y'
    </select>

    <!--게시글 작성-->
    <insert id="insertBoard" parameterType="BoardVo">
        <selectKey keyProperty="boardSno" resultType="Long" order="BEFORE">
            SELECT BOARD_SNO_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        /* 게시글 작성 */
        INSERT INTO BOARD_INFO
            (
                BOARD_SNO
              , TITLE
              , CONTENT
              , USER_ID
              , REG_DATE
            )
        VALUES
            (
                #{boardSno}
              , #{title}
              , #{content}
              , #{userId}
              , SYSDATE
            )
    </insert>

    <!--게시글 상세-->
    <select id="selectBoardDetail" parameterType="map" resultType="BoardVo">
        /* 게시글 상세 조회 */
        SELECT BOARD_SNO AS boardSno
             , TITLE AS title
             , CONTENT AS content
             , USER_ID AS userId
             , USE_YN AS useYn
             , REG_DATE AS regDate
             , MOD_DATE AS modDate
          FROM BOARD_INFO
        <where>
            <if test="boardSno !=null and boardSno !=''">
                BOARD_SNO = #{boardSno}
            </if>
        </where>
    </select>

    <!--게시글 수정-->
    <update id="updateBoard" parameterType="BoardVo">
        /* 게시글 수정 */
        UPDATE BOARD_INFO
           SET
               <if test="title != null and title != ''">
               TITLE = #{title}
               </if>
                <if test="content != null and content != ''">
             , CONTENT = #{content}
                </if>
             , MOD_DATE = SYSDATE
         WHERE BOARD_SNO = #{boardSno}
    </update>

    <!--게시글 삭제-->
    <update id="deleteBoard" parameterType="map">
        /* 게시글 삭제 */
        UPDATE BOARD_INFO
           SET USE_YN = 'N'
         WHERE BOARD_SNO = #{boardSno}
    </update>





</mapper>