<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
<style>
    li {
        list-style: none;
        float: left;
    }
</style>
</head>
<body>
<form id="searchForm">
    <select name="type" id="type">
        <option value="">ì „ì²´</option>
        <option value="T">ì œëª©</option>
        <option value="C">ë‚´ìš©</option>
        <option value="W">ì‘ì„±ì</option>
    </select>
    <input type="text" name="keyword" id="keyword">
    <button type="button" id="searchBtn">ê²€ìƒ‰</button>
    <a th:href="@{/board/reg}">ê¸€ì“°ê¸°</a>
    <div id="count"></div>
<table>
    <thead>
        <th>ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th>ë‚´ìš©</th>
        <th>ì‘ì„±ì</th>
        <th>ë“±ë¡ì¼</th>
    </thead>
    <tbody id="boardBody"></tbody>
</table>
    <div class="tbl-paging"></div>
</form>

<script th:inline="javascript" type="text/javascript">
    //êµ¬ë¶„
    const menu = "board";
    //ê²€ìƒ‰ì¡°ê±´
    let searchData = "";

    $(function () {

        getList("", 1, menu);
    });

    //ê²€ìƒ‰
    $("#searchBtn").on("click", function (e) {
        e.preventDefault();
        searchData = $('#searchForm').serialize();
        getList(searchData, 1, menu);
    });

    /**
     * í˜ì´ì§€ ì´ë™
     * @param currentPage
     */
    function movePage(currentPage){
    	//ê²€ìƒ‰ì¡°ê±´ì´ ìˆì„ ê²½ìš°ì—ë§Œ ê²€ìƒ‰ì¡°ê±´ ì¶”ê°€(ê²€ìƒ‰ì¡°ê±´ ìœ ì§€í•œ ì±„ í˜ì´ì§€ ì´ë™)
    	(searchData != null) ? getList(searchData, currentPage, menu) : getList("", currentPage, menu);
    }

    /**
     * ajax í†µì‹ ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•œë‹¤.
     * @param searchParam ê²€ìƒ‰ì¡°ê±´
     * @param currentPage í˜„ì¬ í˜ì´ì§€
     * @param type ë©”ë‰´íƒ€ì…
     */
    function getList(searchParam, currentPage, type){
        console.log("getList!!!!");
    	$.ajax({
    		url: "/api/" + type +"?currentPage=" + currentPage,
    		type:"get",
    		//IE ë¸Œë¼ìš°ì € ì‚¬ìš© ì•ˆí•œë‹¤ëŠ” ê°€ì •í•˜ì— ì£¼ì„ì²˜ë¦¬
    		// cache: false,
    		data: searchParam,
    		success: function (data){
    			//draw tbody
    			drawTbody(data, type);
    			//draw pagination
    			drawPagination(data.paging);
    		},
    		error:function(e){
    		}
    	});
    }

    /**
     * tbodyì— htmlì„ ë®ì–´ì“´ë‹¤.
     * @param data
     * @param gubun
     */
    function drawTbody(data, gubun) {
        let targetTbody = "boardBody"; // draw ëŒ€ìƒ tbody IDëŠ” ë¬¸ìì—´ë¡œ ì„ ì–¸

        // ğŸ”‘ í•µì‹¬ ìˆ˜ì •: htmlData ë³€ìˆ˜ë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™”
        let htmlData, countHtml = "";

        // foreach start
        for (let i = 0; i < data.list.length; i++) {
            const item = data.list[i]; // item ë³€ìˆ˜ë¡œ ë°ì´í„° ì ‘ê·¼ ê°„ê²°í™”

            // ğŸ”‘ í…œí”Œë¦¿ ë¬¸ìì—´ (Template Literal) ì‚¬ìš©
            htmlData += `
                <tr data-sno="${item.boardSno}">
                    <td>${item.no}</td>
                    <td>
                        <a href='#' onclick='detail("${item.boardSno}")'>
                            ${item.title}
                        </a>
                    </td>
                    <td>${item.content}</td>
                    <td>${item.userId}</td>
                    <td>${item.regDate}</td>
                    <td>
                        <a href='#' onclick='delBoard("${item.boardSno}")'>ì‚­ì œ</a>
                    </td>
                </tr>
            `;
        }
        // foreach end

        // ğŸ”‘ tbodyì— ë°˜ì˜ (targetTbody ë³€ìˆ˜ í™œìš©)
        $("#" + targetTbody).html(htmlData);

        // ğŸ”‘ ì¹´ìš´íŠ¸ ë°˜ì˜
        countHtml = data.count + "ê±´";
        $("#count").text(countHtml);
    }
    // end function getList()

    //ìƒì„¸ë³´ê¸°
    function detail(sno) {
        location.href = "/board/mod/" + sno;
    }

    function delBoard(sno) {
        $.ajax({
            url: "/api/board/" + sno,
            type:"delete",
            //IE ë¸Œë¼ìš°ì € ì‚¬ìš© ì•ˆí•œë‹¤ëŠ” ê°€ì •í•˜ì— ì£¼ì„ì²˜ë¦¬
            // cache: false,
            success: function (data) {
                if(data.code === "1") alert("ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.href = "/board/list"
            },
            error:function(e){
                console.log(e);
            }
        });
    }

    /**
     * í˜ì´ì§€ë„¤ì´ì…˜ì„ ê·¸ë¦°ë‹¤.
     * @param paging
     */
    function drawPagination(paging) {

    	let pageHtml = "";
    	pageHtml += "<ul class='pagination'>";

    	//first
    	const first = parseInt(paging.firstPage);
    	pageHtml += "<li class='paginate_button page-item first'>";

    	if (paging.currentPage === paging.firstPage) {
    		pageHtml += "<button type='button' class='page-link' disabled>";
    	} else {
    		pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ first +")'>";
    	}
    	pageHtml += "<span class='hidden'>first page</span>";
    	pageHtml += "</button>";
    	pageHtml += "</li>"

    	//prev
    	const prev = parseInt(paging.currentPage) -1;
    	pageHtml += "<li class='paginate_button page-item prev'>";

    	if (paging.firstPage === paging.currentPage) {
    		pageHtml += "<button type='button'  class='page-link' disabled>";
    	} else {
    		pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ prev +")'>";
    	}
    	pageHtml += "<span class='hidden'>prev page</span>";
    	pageHtml += "</button>";
    	pageHtml += "</li>";

    	//â‘  ~ â‘©
    	for (let i = paging.firstPageNo; i <= paging.lastPageNo; i++) {
    		pageHtml += "<li class='paginate_button page-item";
    		//í˜„ì¬ í˜ì´ì§€ê°€ ì¸ë±ìŠ¤ì™€ ê°™ìœ¼ë©´ active class ì¶”ê°€
    		if (paging.currentPage === i) {
    			pageHtml += " active'>";
    			pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ i +")'>";
    			pageHtml += i;
    			pageHtml += "</button>";
    			pageHtml += "</li>"
    		} else {
    			pageHtml += "'>";
    			pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ i +")'>";
    			pageHtml += i;
    			pageHtml += "</button>";
    			pageHtml += "</li>"
    		}
    	}

    	//next
    	const next = parseInt(paging.currentPage) + 1;
    	pageHtml += "<li class='paginate_button page-item next'>";

    	if (paging.currentPage === paging.lastPage) {
    		pageHtml += "<button type='button'  class='page-link' disabled>";
    	} else {
    		pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ next +")'>";
    	}
    	pageHtml += "<span class='hidden'>next page</span>";
    	pageHtml += "</button>";
    	pageHtml += "</li>"

    	//last
    	const last = parseInt(paging.lastPage);
    	pageHtml += "<li class='paginate_button page-item last'>";

    	if (paging.currentPage === paging.lastPage) {
    		pageHtml += "<button type='button'  class='page-link' disabled>";
    	} else {
    		pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ last +")'>";
    	}
    	pageHtml += "<span class='hidden'>last page</span>";
    	pageHtml += "</button>";
    	pageHtml += "</li>"

    	pageHtml += "</ul>";
    	//í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ì— ë°˜ì˜
    	$(".tbl-paging").html(pageHtml);
    }


</script>

</body>
</html>