<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œíŒ ëª©ë¡</title>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
<style>
    /* ğŸ”‘ ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ Wrapper ìŠ¤íƒ€ì¼ */
.main-content-wrapper {
    /* body íƒœê·¸ì™€ ë™ì¼í•˜ê²Œ ì¤‘ì•™ì— ìœ„ì¹˜ */
    max-width: 1000px;
    margin: 0 auto;
    padding: 0;
}

    /* ğŸ”‘ ì „ì²´ ì˜ì—­ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    body {
        font-family: 'Malgun Gothic', sans-serif;
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background-color: #f8f8f8;
    }

    li {
        list-style: none;
        float: left;
    }

    /* ======================================= */
    /* ğŸ”‘ ì•¡ì…˜ë°” ë° ê²€ìƒ‰ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .action-bar-container {
        display: flex;
        justify-content: space-between; /* ê²€ìƒ‰ì°½ ê·¸ë£¹ê³¼ ê¸€ì“°ê¸° ë²„íŠ¼ ë¶„ë¦¬ */
        align-items: center;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e0e0; /* í•˜ë‹¨ êµ¬ë¶„ì„  */
        margin-bottom: 20px;
    }

    /* ğŸ”‘ ê²€ìƒ‰ í¼ ë° ì¹´ìš´íŠ¸ ê·¸ë£¹ */
    #searchGroup {
        display: flex;
        align-items: center;
        gap: 10px; /* ìš”ì†Œ ê°„ ê°„ê²© */
    }

    /* ğŸ”‘ ê²€ìƒ‰ í¼ ìì²´ ìŠ¤íƒ€ì¼ */
    #searchForm {
        display: flex;
        align-items: center;
        gap: 8px; /* ìš”ì†Œ ê°„ ê°„ê²© */
    }

    /* ğŸ”‘ ì¹´ìš´íŠ¸ í‘œì‹œ ìŠ¤íƒ€ì¼ (ì¬ì •ì˜: í…Œì´ë¸” ì¢Œì¸¡ í•˜ë‹¨ ë°°ì¹˜) */
    #count {
        font-size: 1.1em;
        font-weight: 700;
        color: #34495e; /* ì–´ë‘ìš´ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½ */
        margin-top: 10px;
        text-align: left; /* í…ìŠ¤íŠ¸ë¥¼ ì¢Œì¸¡ìœ¼ë¡œ ì •ë ¬ */
        padding-left: 0;
        border-left: none; /* ì„¸ë¡œì„  ì œê±° */

        /* ğŸ”‘ Action Barì˜ 35px ì •ë ¬ ìŠ¤íƒ€ì¼ ì œê±° */
        height: auto;
        line-height: normal;
    }

    /* ğŸ”‘ Select ë° Input í•„ë“œ ìŠ¤íƒ€ì¼ */
    #searchForm select, #searchForm input[type="text"] {
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 0.95em;
        height: 35px; /* ë†’ì´ í†µì¼ */
        box-sizing: border-box;
        margin: 0;
    }

    #searchForm select {
        appearance: none; /* ê¸°ë³¸ OS ìŠ¤íƒ€ì¼ ì œê±° */
        -webkit-appearance: none;
        background-color: white;
    }

    /* ğŸ”‘ ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .action-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s;
    }

    /* ğŸ”‘ ê²€ìƒ‰ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #searchBtn {
        background-color: #3f51b5; /* Primary Color */
        color: white;
    }
    #searchBtn:hover { background-color: #334298; }

    /* ğŸ”‘ ê¸€ì“°ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .write-btn {
        background-color: #1e8449; /* Success Color */
        color: white;
        padding: 10px 15px;
        text-decoration: none;
        border-radius: 4px;
    }
    .write-btn:hover { background-color: #1a6f3b; }

    /* ======================================= */
    /* ğŸ”‘ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .styled-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 0.95em;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #e0e0e0;
    }

    .styled-table thead th {
        background-color: #3f51b5;
        color: white;
        padding: 12px 8px;
        text-align: center;
        font-weight: 600;
        border: none;
    }

    .styled-table tbody td {
        border-bottom: 1px solid #eeeeee;
        padding: 10px 8px;
        text-align: center;
        transition: background-color 0.2s;
    }

    .styled-table tbody tr:hover {
        background-color: #f0f8ff;
        cursor: pointer;
    }

    .styled-table tbody td:nth-child(2) {
        text-align: left;
    }

    /* ğŸ”‘ Pagination ìŠ¤íƒ€ì¼ (ê°•í™”) */
    .tbl-paging {
        text-align: center; /* divë¥¼ ì¤‘ì•™ ì •ë ¬ */
        margin-top: 25px;
    }

    .tbl-paging ul {
        display: flex;
        justify-content: center;
        padding-left: 0;
        margin: 0;
    }

    .tbl-paging li {
        margin: 0 4px; /* ë²„íŠ¼ ê°„ê²© ì¡°ì • */
        list-style: none;
        float: left;
    }

    /* ğŸ”‘ ì‚­ì œ ë§í¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê²½ê³ ìƒ‰) */
    .delete-link-btn {
        background-color: #dc3545; /* Danger Color (ë¹¨ê°„ìƒ‰) */
        color: white;
        padding: 6px 10px; /* í…Œì´ë¸” ì…€ì— ë§ê²Œ í¬ê¸° ì¡°ì • */
        text-decoration: none;
        border-radius: 4px;
        font-size: 0.9em;
        display: inline-block; /* a íƒœê·¸ë¥¼ ë²„íŠ¼ì²˜ëŸ¼ ë³´ì´ê²Œ */
        transition: background-color 0.2s;
        font-weight: 600;
    }
    .delete-link-btn:hover { background-color: #a82733; }
/* ğŸ”‘ í˜ì´ì§€ ë§í¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.tbl-paging .page-link {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 8px 12px; /* íŒ¨ë”© ì¦ê°€ */
    background-color: white;
    color: #3f51b5; /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    min-width: 38px; /* ë²„íŠ¼ ìµœì†Œ ë„ˆë¹„ */
    display: block;
}

/* ğŸ”‘ í˜„ì¬ í˜ì´ì§€ (Active) ìŠ¤íƒ€ì¼ */
.tbl-paging .active .page-link {
    background-color: #3f51b5; /* Primary Color */
    color: white;
    border-color: #3f51b5;
    font-weight: bold;
}

/* ğŸ”‘ ë¹„í™œì„±í™” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.tbl-paging .page-link:disabled {
    background-color: #f8f8f8;
    color: #a0a0a0;
    cursor: not-allowed;
    border-color: #e0e0e0;
}
</style>
</head>
<body>
<div class="main-content-wrapper">
    <div class="action-bar-container">
        <div id="searchGroup">
            <form id="searchForm" class="d-flex">
                <select name="type" id="type" class="form-select">
                    <option value="">ì „ì²´</option>
                    <option value="T">ì œëª©</option>
                    <option value="C">ë‚´ìš©</option>
                    <option value="W">ì‘ì„±ì</option>
                </select>
                <input type="text" name="keyword" id="keyword" class="form-control">
                <button type="button" id="searchBtn" class="action-btn">ê²€ìƒ‰</button>
            </form>
        </div>
        <a th:href="@{/board/reg}" class="write-btn">ê¸€ì“°ê¸°</a>
    </div>

    <table class="styled-table">
        <thead>
            <tr>
                <th>ë²ˆí˜¸</th>
                <th>ì œëª©</th>
                <th>ë‚´ìš©</th>
                <th>ì‘ì„±ì</th>
                <th>ë“±ë¡ì¼</th>
                <th>ì‚­ì œ</th>
            </tr>
        </thead>
        <tbody id="boardBody"></tbody>
    </table>
    <div id="count"></div>

    <div class="tbl-paging"></div>
</div>
<script th:inline="javascript" type="text/javascript">
    //êµ¬ë¶„
    const menu = "board";
    //ê²€ìƒ‰ì¡°ê±´
    let searchData = "";

    $(function () {
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
        getList("", 1, menu);
    });

    //ê²€ìƒ‰
    $("#searchBtn").on("click", function (e) {
        e.preventDefault();
        searchData = $('#searchForm').serialize();
        getList(searchData, 1, menu);
    });

    /**
     * í˜ì´ì§€ ì´ë™
     * @param currentPage
     */
    function movePage(currentPage){
        (searchData !== "") ? getList(searchData, currentPage, menu) : getList("", currentPage, menu);
    }

    /**
     * ajax í†µì‹ ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•œë‹¤.
     */
    function getList(searchParam, currentPage, type){
        console.log("getList!!!!");
        $.ajax({
           url: "/api/" + type +"?currentPage=" + currentPage,
           type:"get",
           data: searchParam,
           success: function (data){
              drawTbody(data, type);
              drawPagination(data.paging);
           },
           error:function(e){
               console.error("AJAX Error:", e);
           }
        });
    }

    /**
     * tbodyì— htmlì„ ë®ì–´ì“´ë‹¤. (í…œí”Œë¦¿ ë¬¸ìì—´ ì‚¬ìš©)
     */
    function drawTbody(data, gubun) {
        let targetTbody = "boardBody";
        let htmlData = "";
        let countHtml = "";

        if(!data || !data.list || data.list.length !== 0) {
            // foreach start
            for (let i = 0; i < data.list.length; i++) {
                const item = data.list[i];

                // í…œí”Œë¦¿ ë¬¸ìì—´ (Template Literal) ì‚¬ìš©
                htmlData += `
                    <tr data-sno="${item.boardSno}">
                        <td>${item.no}</td>
                        <td>
                            <a href='#' onclick='detail("${item.boardSno}")'>
                                ${item.title} [${item.replyCnt}]
                            </a>
                        </td>
                        <td>${item.content}</td>
                        <td>${item.userId}</td>
                        <td>${item.regDate}</td>
                        <td>
                            <a href='#' onclick='delBoard("${item.boardSno}")' class="delete-link-btn">ì‚­ì œ</a>
                        </td>
                    </tr>
                `;
            }
            // foreach end
        } else {
            htmlData = `
                <tr>
                    <td colspan="6" style="text-align: center; color: gray; padding: 20px;">
                        ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </td>
                </tr>
            `;
        }
        // tbodyì— ë°˜ì˜
        $("#" + targetTbody).html(htmlData);

        // ì¹´ìš´íŠ¸ ë°˜ì˜
        const displayCount = (data && data.count) ? data.count : 0;
        $("#count").text(displayCount + "ê±´");
    }

    //ìƒì„¸ë³´ê¸°
    function detail(sno) {
        location.href = "/board/mod/" + sno;
    }

    function delBoard(sno) {
        if (!confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        $.ajax({
            url: "/api/board/" + sno,
            type:"delete",
            success: function (data) {
                if(data.code === "1") alert("ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.href = "/board/list"
            },
            error:function(e){
                console.log(e);
                alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }

    /**
     * í˜ì´ì§€ë„¤ì´ì…˜ì„ ê·¸ë¦°ë‹¤.
     * @param paging
     */
    function drawPagination(paging) {

        let pageHtml = "";
        pageHtml += "<ul class='pagination'>";

        //first
        const first = parseInt(paging.firstPage);
        pageHtml += "<li class='paginate_button page-item first'>";

        if (paging.currentPage === paging.firstPage) {
           pageHtml += "<button type='button' class='page-link' disabled>";
        } else {
           pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ first +")'>";
        }
        pageHtml += "<span class='hidden'>first page</span>";
        pageHtml += "</button>";
        pageHtml += "</li>"

        //prev
        const prev = parseInt(paging.currentPage) -1;
        pageHtml += "<li class='paginate_button page-item prev'>";

        if (paging.firstPage === paging.currentPage) {
           pageHtml += "<button type='button'  class='page-link' disabled>";
        } else {
           pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ prev +")'>";
        }
        pageHtml += "<span class='hidden'>prev page</span>";
        pageHtml += "</button>";
        pageHtml += "</li>";

        //â‘  ~ â‘©
        for (let i = paging.firstPageNo; i <= paging.lastPageNo; i++) {
           pageHtml += "<li class='paginate_button page-item";
           //í˜„ì¬ í˜ì´ì§€ê°€ ì¸ë±ìŠ¤ì™€ ê°™ìœ¼ë©´ active class ì¶”ê°€
           if (paging.currentPage === i) {
              pageHtml += " active'>";
              pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ i +")'>";
              pageHtml += i;
              pageHtml += "</button>";
              pageHtml += "</li>"
           } else {
              pageHtml += "'>";
              pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ i +")'>";
              pageHtml += i;
              pageHtml += "</button>";
              pageHtml += "</li>"
           }
        }

        //next
        const next = parseInt(paging.currentPage) + 1;
        pageHtml += "<li class='paginate_button page-item next'>";

        if (paging.currentPage === paging.lastPage) {
           pageHtml += "<button type='button'  class='page-link' disabled>";
        } else {
           pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ next +")'>";
        }
        pageHtml += "<span class='hidden'>next page</span>";
        pageHtml += "</button>";
        pageHtml += "</li>"

        //last
        const last = parseInt(paging.lastPage);
        pageHtml += "<li class='paginate_button page-item last'>";

        if (paging.currentPage === paging.lastPage) {
           pageHtml += "<button type='button'  class='page-link' disabled>";
        } else {
           pageHtml += "<button type='button'  class='page-link' style='cursor: pointer;' onclick='movePage("+ last +")'>";
        }
        pageHtml += "<span class='hidden'>last page</span>";
        pageHtml += "</button>";
        pageHtml += "</li>"

        pageHtml += "</ul>";
        //í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ì— ë°˜ì˜
        $(".tbl-paging").html(pageHtml);
    }


</script>

</body>
</html>