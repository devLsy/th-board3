<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>(외부)설문 응시 목록</title>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script th:src="@{/js/common.js}"></script>
    <link rel="stylesheet" th:href="@{/css/common.css}">
</head>
<body>
<div class="main-content-wrapper">

    <div class="sidebar-menu">
        <h3>게시판 메뉴</h3>
        <ul>
            <li><a th:href="@{/board/list}">게시판 목록</a></li>
            <li class="active"><a th:href="@{/survey/ext/list}">설문조사 관리</a></li>
            <li><a href="#">커뮤니티</a></li>
            <li><a href="#">관리자 대시보드</a></li>
        </ul>
    </div>

    <div class="content-area">

        <h1>[[${userId}]]님의 설문 응시 목록</h1>

        <div class="button-container">
            <button type="button" class="survey-register-btn" id="registerBtn" th:attr="data-user-id=${userId}">
                + 설문 등록하기
            </button>
        </div>

        <form id="searchForm">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>번호</th>
                        <th>업체명</th>
                        <th>평가자ID</th>
                        <th>평가자명</th>
                        <th>점검일시</th>
                        <th>종합점수</th>
                    </tr>
                </thead>
                <tbody id="boardBody">
                    <tr th:each="survey, stat : ${surveyList}"
                        th:if="${not #lists.isEmpty(surveyList)}"  th:data-session-key="${survey.SESSIONKEY}"
                        th:data-user-id="${survey.USERID}">

                        <td th:text="${stat.count}"></td>
                        <td th:text="${survey.COMPANYNM}"></td>
                        <td th:text="${survey.USERID}"></td>
                        <td th:text="${survey.USERNM}"></td>
                        <td th:text="${#dates.format(survey.ANSWERAT, 'yyyy-MM-dd HH:mm')}"></td>
                        <td th:text="${survey.TOTALSCORE}"></td>
                    </tr>

                    <tr th:unless="${not #lists.isEmpty(surveyList)}"> <td colspan="6" style="text-align: center; color: gray; padding: 20px;">
                            <p>조회할 데이터가 없습니다.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>
<script th:inline="javascript" type="text/javascript">
    /* <![CDATA[ */
    $(document).ready(function() {
        // 목록 행 클릭 (상세 페이지 이동)
        $('#boardBody tr').on('click', function() {
            const sessionKey = $(this).data('session-key');
            const userId = $(this).data('user-id');

            if (sessionKey && userId) {
                location.href = "/survey/ext/detail?userId=" + userId + "&sessionKey=" + sessionKey;
            } else {
                alert("필수 정보가 누락되었습니다.");
            }
        });

        // 등록 버튼 클릭 (등록 페이지 이동)
        $('#registerBtn').on('click', function() {
            const userId = $(this).data('user-id');
            if (userId) {
                // Controller의 /survey/ext/register?userId=XXX 호출
                location.href = "/survey/ext/reg?userId=" + userId;
            } else {
                 alert("사용자 ID를 찾을 수 없습니다.");
            }
        });
    });
    /* ]]> */
</script>
</body>
</html>